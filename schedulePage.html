<!DOCTYPE html>
<html lang="en">
<head>

<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>



  <script
  src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"
  integrity="sha256-0YPKAwZP7Mp3ALMRVB2i8GXeEndvCq3eSl/WsAl1Ryk="
  crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.21.0/moment.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css"/>

    <link rel="stylesheet" type="text/css" src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.print.css"/>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>




	<style>
	@import url(https://fonts.googleapis.com/css?family=Roboto:300);

	body {
  margin: 0;
  padding: 0;
  background: #ccc;
}

.nav ul {
  list-style: none;
  background-color: #80ced6;
  text-align: center;
  padding: 0;
  margin: 0;
}
.nav li {
  font-family: 'Roboto', sans-serif;
  font-size: 1.2em;
  line-height: 40px;
  height: 40px;
  border-bottom: 1px solid #888;
}

.nav a {
  text-decoration: none;
  color: #fff;
  display: block;
  transition: .3s background-color;
}

.nav a:hover {
  background-color: #005f5f;
}

.nav a.active {
  background-color: #fff;
  color: #444;
  cursor: default;
}

@media screen and (min-width: 600px) {
  .nav li {
    width: 150px;
    border-bottom: none;
    height: 50px;
    line-height: 50px;
    font-size: 1.4em;
  }

  /* Option 1 - Display Inline */
  .nav li {
    display: inline-block;
    margin-right: -4px;
  }

.modal-body .form-horizontal .col-sm-2,
.modal-body .form-horizontal .col-sm-10 {
    width: 100%
}

.modal-body .form-horizontal .control-label {
    text-align: left;
}
.modal-body .form-horizontal .col-sm-offset-2 {
    margin-left: 15px;
}
textarea {
  resize: none;
}
.timepicker{z-index:1151;}
.timepicker.dropdown-menu {z-index:1151;}






	body {
	}
	</style>

	<meta charset="utf-8">

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<script>
  

	$(document).ready(function () {

    //function to convert date to a moment 
    function convertTime(date){
      var justTime= date.substring(0,5);
      var timeArray=justTime.split(":");
      var hours= parseInt(timeArray[0]);
      console.log("hours:"+hours);
      var minutes= parseInt(timeArray[1]);
      if(date.includes("PM")&&hours<12){
          hours=hours+12;
      }else if(hours ===12){
        hours=0;
      }
      if(hours<10){
        hours= "0"+hours.toString();
      }
      if(minutes<10){
        minutes="0"+minutes.toString();
      }
      return hours+":"+minutes+":00"

    };
    var startDate=null;
    var endDate=null;

    

    $('input.timepicker').timepicker({
      zindex:1151

    });

//The function that controls he jobsumbit action, outside as to not add multiple click functions to the dev
         $("#jobSubmit").click(function(){
          var jtitle = $("#jtitle").val();
         var jdescription = $("#jdescription").val();
         var startTime = $("#startTime").val();
         startTime=convertTime(startTime);
         console.log(startTime)
         var endTime = $("#endTime").val();
         endTime= convertTime(endTime);
  

         var employeeCount = $("#employeeCount").val();
         var preferred_skills = $("#jdescription2").val();
         var preferred_skills = $("#jdescription2").val();
         var important_quality;
         if($('#industryExp').is(':checked')){
          important_quality="Industry Experience";
         }else if($('#profAp').is(':checked')){
          important_quality="Professional Appearance"
         }else if($('#proximity').is(':checked')){
          important_quality="Proximity to Job Location"
         }else{
            important_quality="Punctuality";
         }
         var rate = $("#rate").val();


         var jobInfo={
         "date": moment(startDate).format(),
         "rate": rate,
         "dress_code": " ",
         "duration":0,
         "open": true,
         "job_title": jtitle,
         "start_time":startTime,
         "end_time":endTime,
         "company_id":sessionStorage.getItem("company_id"),
         "description":jdescription,
         "important_quality": important_quality,
         "preferred_skills": preferred_skills,
          "num_employees": employeeCount

          };

         var ajaxFunction= function (){
        return $.ajax({
          type: 'POST',
          contentType: "application/json",
          url: 'https://uzo-web-app.herokuapp.com/insert_job',
          data:JSON.stringify(jobInfo)
        }).done(function(data) {
          var result= JSON.parse(data);
          console.log(result.affected_rows);


        });
      }
      
        $.when(ajaxFunction()).done(function(response){
            //alert("Job Added");
        });

        var eventData= [{ title  : jtitle,start: moment(startDate).format()+"T"+startTime, end:moment(endDate).format()+"T"+endTime, allDay: false}];

            $("#calendar").fullCalendar('addEventSource', eventData);
            $("#calendar").fullCalendar("unselect");
            $("#createJobModal").modal("hide");
       

        });

      //Page navigation section 

     $("#payment_info").click(function(){
       window.location.replace("paymentInfo.html");

     });

    if(!sessionStorage.getItem("company_id")){

            window.location.replace("index.html");
          }else{
            console.log(sessionStorage.getItem("company_id"));
          }

          var companyInfo={
         "company_id": sessionStorage.getItem("company_id")

          }

//Ensure that jobs are loaded on signin and run the full calendar functions actas a main method 
    var companyJobListFunction= function (){
        return $.ajax({
          type: 'POST',
          contentType: "application/json",
          url: 'https://uzo-web-app.herokuapp.com/get_company_job_list',
          data:JSON.stringify(companyInfo)
        }).done(function(data) {
          var result= JSON.parse(data);
          var jobs= []
          if(!(result==null ||result==undefined ||result=="undefined")){
          for(i=0;i<result.length;i++){
            jobs.push({
            "title":result[i].job_title,
            "start":result[i].date+"T"+result[i].start_time,
            "end":result[i].date+"T"+result[i].end_time,
            "allDay": false,
            "job_id":result[i].job_id 
          });
          }
          console.log(jobs)
            
            //initial events
            
            $('#calendar').fullCalendar({


              events: jobs,
            
        //Need to add a create Event Button
        header: {
      left: 'month,agendaWeek,agendaDay',
      center: 'title',
      right: 'custom2 prevYear,prev,next,nextYear'
      },
    // put your options and callbacks here
      selectable: true,
       dayClick: function(date, jsEvent, view) {
          $("#createJobModal").modal("show");
          startDate=date;
          endDate=date;
          //for now I'll just use the an random array
          /*
            Once steven has added the add event data I will us that in the add event source
            get the current date using this moment(start).format('MM/DD/YYYY') and the time rotater the n append using T and store in DB

            {
         "date": "2018-06-15",
         "rate": "40/hr",
         "dress_code": "Formal",
         "duration":2.5,
         "open": true,
         "job_title": "Janitor",
         "time":2300,
         "company_id":1,
         "description":"chillen"
         "important_quality": "idk",
         "preferred_quality": "idk"

}

         */

        
        },

       eventClick: function(calEvent, jsEvent, view) {
        $("#showJobModal").modal("show");

        console.log('Event: ' + calEvent.title);
        console.log('Start: ' + moment(calEvent.start).format('MM/DD/YYYY'));
        console.log('Finish: ' + moment(calEvent.end).format('MM/DD/YYYY'));
        console.log('View: ' + view.name);

        // change the border color just for fun
        $(this).css('border-color', 'red');

      }

     })

          


          }
          


        });
      }
      
      
        $.when(companyJobListFunction()).done(function(response){
            

        });

        

    //moment().format('MMMM Do YYYY, h:mm:ss a')

      
      


});



	</script>
</head>

<body class="client">
  <header>
    <div class="nav">
      <ul>
        <li class="schedule"><a class="active" href="#first" data-toggle="tab" id="shedule">My Schedule</a></li>
        <li class="payment_info"><a  href="#fifth" data-toggle="tab" id="payment_info">Payment Info</a></li>
      </ul>
    </div>
		<div class="tab-content">

    <div id="first" class="tab-pane fade in active">
        <div id='calendar'>

        </div>
    </div>


    </div>
  </header>


  <!-- Modal -->
  <div class="modal fade bd-example-modal-lg" id="createJobModal" role="dialog">
    <div class="modal-dialog modal-lg">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Add Job</h4>
        </div>
        <div class="modal-body">
        <form class="form-horizontal" role="form">
          <div class="form-group">
            <div class="col-md-6">
            <label for="jtitle">Job Title</label>
            <div class="has-error" id="titleError">
            <div class="input-group">
              <input type="text" class="form-control" name="jtitle" id="jtitle"/>
            </div>
          </div>
            <br>
              <label for="jobDesc">Description of Job</label>
              <div class="has-error" id="descriptionError">
              <div class="input-group">
								<textarea rows="4" cols="55" placeholder="In a few sentences, tell us what the position entails?" id="jdescription">
								</textarea>
							</div>
            </div>
              <br>
              <div class="has-error" id="startError">
              <label for="shitStart">What time does the shift start</label>
                <input type="text" class="timepicker" name="time" id="startTime"/>
              </div>
              <br>
              <label for="shitStart">What time does the shift end</label>
              <div>
                <div class="has-error" id="endError">
                <input type="text" class="timepicker" name="time" id="endTime"/>
              </div>
            </div>
              <br>
              <div>
              <label for="ecount">How many employees do you need per shift?</label>
              <form>
                <select  id="employeeCount">
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select>
              </form>
              </div>
            </div>

            <div class="col-md-6">
              <label for="jobDesc2">Are their any required or preferred skills, certifications, or education requirements for workers?</label>
              <div class="input-group">
                <textarea rows="4" cols="55" id="jdescription2">
                </textarea>
              </div>
              <br>
              <div>
                <label for="quality">What is the most important quality you're looking for in your workers?</label>
                <form id="important_quality">
                  <input type="radio" name="option" value="Industry Experience" id= "industryExp"> Industry Experience <br>
                  <input type="radio" name="option" value="Professional Appearance" id= "profAp"> Professional Appearance<br>
                  <input type="radio" name="option" value="Proximity to Job Location" id= "proximity"> Proximity to Job Location<br>
                  <input type="radio" name="option" value="Punctuality" id= "punctuality"> Punctuality<br>
                </form>
              </div>
              <br>
              <div class="form-row">
                <label for="c2">Hourly Rate</label>
                <div class="input-group">
                  <span class="input-group-addon">$</span>
                  <input type="number" value="15" min="0" step="0.01" data-number-to-fixed="2" data-number-stepfactor="100" class="form-control currency" id="rate" />
                </div>
              </div>


          </div>
        </form>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal" id = "jobSubmit">Submit</button>
        </div>
      </div>

    </div>
  </div>



  

</body>

</html>
